{
  "kind": "build_request",
  "title": "Enable per-innings scorecard updates with player selection (names)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the backend match performance data model so bowling (and any other per-innings scorecard items needed by the UI) can be stored and queried per innings, not only as a single combined list.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add the feature of updating scorecard along with player names in each innings"
        ]
      },
      "acceptanceCriteria": [
        "Bowler performance records include an `innings : Nat` field so the frontend can filter bowlers by innings reliably.",
        "Existing match data can still be read after the change (no traps / decode errors)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add backend APIs to create and update (not only append) per-innings scorecard entries so users can correct player selection (playerId) and score values for a specific match and innings.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add the feature of updating scorecard along with player names in each innings"
        ]
      },
      "acceptanceCriteria": [
        "There is a backend update/upsert API for batsman performance that targets a specific match and innings and persists changes (including changing the playerId for the row).",
        "There is a backend update/upsert API for bowler performance that targets a specific match and innings and persists changes (including changing the playerId for the row).",
        "Authorization matches existing match-modification rules (admins or owners of either team in the match can modify; others are rejected with an Unauthorized trap message)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add/extend state migration so existing canister state is preserved when upgrading to the new per-innings scorecard schema (including defaults for any newly added fields such as bowler `innings`).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add the feature of updating scorecard along with player names in each innings"
        ]
      },
      "acceptanceCriteria": [
        "Upgrading a canister with existing matches succeeds and existing matches remain accessible via `getAllMatches`/`getMatchById`.",
        "Existing bowler performance entries receive a deterministic default innings value during migration (documented in code)."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Implement an editable per-innings scorecard UI that lets an authenticated user update player selection (player name via selecting a player) and scorecard values for each innings (Innings 1 and Innings 2), and save those edits to the backend.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add the feature of updating scorecard along with player names in each innings"
        ]
      },
      "acceptanceCriteria": [
        "In the Match edit dialog, the per-innings editor allows selecting a player for each batting/bowling row from the existing Players list (showing player names), and editing the relevant numeric fields.",
        "The user can edit Innings 1 and Innings 2 independently (changes in one innings do not affect the other innings).",
        "Saving edits triggers backend mutations and the displayed scorecard refreshes immediately after success (React Query cache invalidation).",
        "If the user is not authenticated, the UI remains read-only and clearly indicates login is required (English text)."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Update React Query hooks and generated frontend backend bindings/types to support the new/updated backend scorecard APIs and any new fields (e.g., bowler `innings`) so the per-innings editor can read and write data end-to-end.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Add the feature of updating scorecard along with player names in each innings"
        ]
      },
      "acceptanceCriteria": [
        "New React Query mutation hooks exist for the new backend scorecard update/upsert APIs and are used by the per-innings editor.",
        "After successful mutations, match queries that power the scorecard UI are invalidated/refetched so the UI reflects saved changes without a manual refresh.",
        "TypeScript types used by the UI compile cleanly after the backend Candid/interface changes."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor with logic in backend/main.mo; only add backend/migration.mo changes if state upgrade is required.",
    "Do not edit files under frontend/src/components/ui or any frontend immutablePaths (compose existing UI components instead).",
    "Use English for all user-facing UI text."
  ],
  "nonGoals": [
    "Implementing real-time updates (WebSockets/push) for scorecard changes.",
    "Adding third-party authentication (only Internet Identity is allowed).",
    "Adding external databases or non-Motoko backend services."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}